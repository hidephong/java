define(["jquery","handlebars","jquery-migrate","ud.package.default"],function(e,t){e.widget("ud.ud_multiplechoicequestionformitem",{options:{inputId:null,type:"bullet"},choicesList:null,_create:function(){for(var t in this.options)typeof this.element.data(t.toLowerCase())!="undefined"&&(this.options[t]=this.element.data(t.toLowerCase()));this.choicesDiv=e(".choices",this.element),this.inputForm=e("#input-"+this.options.inputId,this.element),this.hiddenForm=e("#"+this.options.inputId,this.element),this.choicesList=e("#choices-list-"+this.options.inputId,this.choicesDiv),e("textarea",this.choicesList).live("focus",this.inputOnFocus.context(this)),e(".choice-delete",this.element).live("click",this.removeChoiceOnClick.context(this)),this._initHandlebarsTemplates(),this.updateChoices()},_initHandlebarsTemplates:function(){this.multipleChoiceQuestionFormItemInputTextTemplate=t.compile(e("#multipleChoiceQuestionFormItemInputTextTemplate").html())},inputOnFocus:function(t){var n=e(t.currentTarget),r=e("textarea",this.choicesList),i=r.length,s=r.index(n);s==i-1&&this.addChoice()},addChoice:function(e){typeof e=="undefined"&&(e="");var t=Math.random().toString(36).substr(2);this.choicesList.append(this.multipleChoiceQuestionFormItemInputTextTemplate({inputId:this.options.inputId,value:e,uniqueId:t})),this.choicesList.ud_initialize(),this.updateChoices()},removeChoiceOnClick:function(t){t&&t.preventDefault();if(e("li",this.choicesList).length>1){var n=e(t.currentTarget).parents("li").eq(0);this.removeChoice(n)}},removeChoice:function(e){e.remove(),this.updateChoices()},addInputText:function(){var e=Math.random().toString(36).substr(2);this.choicesList.append(this.multipleChoiceQuestionFormItemInputTextTemplate({inputId:this.options.inputId,value:"",uniqueId:e})),this.choicesList.ud_initialize()},removeEmptyInputTexts:function(){var t=e("textarea",this.choicesList);t.each(function(t,n){var r=e(n).val();r||e(n).parent().remove()}.context(this))},getChoiceContent:function(t){var n=e("textarea",this.choicesList),r=null;return t<n.length&&(r=n[t].value),r},updateChoices:function(){var t=e("textarea",this.choicesList),n=[];t.each(function(t,r){var i=e(r).val();i&&n.push(i)}.context(this));var r=JSON.stringify({items:n});this.hiddenForm.val(r)}})});