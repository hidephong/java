



<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
    <head>
        <title>Configuration (The Java&trade; Tutorials &gt; 
            Java Naming and Directory Interface(TM). &gt; Advanced Topics for LDAP Users)
</title>
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #E76F00;
        font-family: sans-serif; 
        font-weight: bold;
        font-size: 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;
        font-size: smaller;
        font-family: sans-serif; 
    }
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #E76F00;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h3, h4, h5 {
        color: #E76F00;
        font-family: sans-serif;
    }
    #ToggleLeft {
        display: none;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Java Naming and Directory Interface(TM).
        <br><b>Lesson:</b> Advanced Topics for LDAP Users
        <br><b>Section:</b> Connection Management
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Advanced Topics for LDAP Users</a></div>
<div class="linkAHEAD"><a href="ldap.html">LDAP v3</a></div>
<div class="linkAHEAD"><a href="jndi.html">JNDI as an LDAP API</a></div>
<div class="linkBHEAD"><a href="operations.html">How LDAP Operations Map to JNDI APIs</a></div>
<div class="linkBHEAD"><a href="exceptions.html">How LDAP Error Codes Map to JNDI Exceptions</a></div>
<div class="linkAHEAD"><a href="security.html">Security</a></div>
<div class="linkBHEAD"><a href="authentication.html">Modes of Authenticating to LDAP</a></div>
<div class="linkBHEAD"><a href="auth_mechs.html">Authentication Mechanisms</a></div>
<div class="linkBHEAD"><a href="anonymous.html">Anonymous</a></div>
<div class="linkBHEAD"><a href="simple.html">Simple</a></div>
<div class="linkBHEAD"><a href="sasl.html">SASL</a></div>
<div class="linkBHEAD"><a href="digest.html">Digest-MD5</a></div>
<div class="linkBHEAD"><a href="ssl.html">SSL and Custom Sockets</a></div>
<div class="linkAHEAD"><a href="rename.html">More LDAP Operations</a></div>
<div class="linkBHEAD"><a href="compare.html">LDAP Compare</a></div>
<div class="linkBHEAD"><a href="result.html">Search Results</a></div>
<div class="linkBHEAD"><a href="unsol.html"> LDAP Unsolicited Notifications</a></div>
<div class="linkAHEAD"><a href="connect.html">Connection Management</a></div>
<div class="linkBHEAD"><a href="create.html">Creation</a></div>
<div class="linkBHEAD"><a href="close.html"> Closing</a></div>
<div class="linkBHEAD"><a href="pool.html">Pooling</a></div>
<div class="nolinkBHEAD">Configuration</div>
<div class="linkAHEAD"><a href="faq.html">Frequently Asked Questions</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Java Naming and Directory Interface(TM).</a>
                &gt;
                <a href=index.html target=_top>Advanced Topics for LDAP Users</a>
            </span>
            <div class=NavBit>
                <a target=_top href=pool.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=faq.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle>Configuration</div>
            <blockquote>
Connection pooling is configured and maintained per Java runtime.
Connections are not shared across different runtimes.  To use
connection pooling, no configuration is required.  Configuration is
necessary only if you want to customize how pooling is done, such as
to control the size of the pools and which types of connections are pooled.
<p>
You configure connection pooling by using
a number of system properties at program startup time. 
Note that these are system properties,
<em>not</em> environment properties and that they affect all connection pooling
requests.

<p>
Here is an example of a command line that
sets the maximum pool size to 20, the preferred pool size to 10,
and the idle timeout to a minute for pooled connections.
<blockquote><pre>
# java -Dcom.sun.jndi.ldap.connect.pool.maxsize=20 \
       -Dcom.sun.jndi.ldap.connect.pool.prefsize=10 \
       -Dcom.sun.jndi.ldap.connect.pool.timeout=60000 \
    UsePool
</pre></blockquote>

<p>
The following table lists the system properties for configuring
connection pooling. They are described in more detail
in the rest of this section. 
<p>

<center><table BORDER COLS=3 WIDTH="100%" NOSAVE>
<tr NOSAVE>
<th NOSAVE>System Property Name</th>

<th NOSAVE>Description</th>

<th NOSAVE>Default</th>
</tr>

<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.authentication</tt></td>
<td NOSAVE>A list of space-separated authentication types of connections
that may be pooled. Valid types are "none", "simple", and "DIGEST-MD5".
</td>
<td NOSAVE><tt>"none simple"</tt></td>
</tr>

<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.debug</tt></td>
<td NOSAVE>A string that indicates the level of debug output to produce.
Valid values are <tt>"fine"</tt> (trace connection creation and removal)
and "all" (all debugging information).
</td>
<td NOSAVE>&nbsp;</td>
</tr>

<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.initsize</tt></td>
<td NOSAVE>The string representation of an integer that represents
the number of connections per connection identity to create when
initially creating a connection for the identity.  
</td>
<td NOSAVE>1</td>
</tr>

<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.maxsize</tt></td>
<td NOSAVE>The string representation of an integer that represents
the maximum number of connections per connection identity that
can be maintained concurrently.</td>
<td NOSAVE>no maximum size</td>
</tr>

<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.prefsize</tt></td>
<td NOSAVE>The string representation of an integer that represents
the preferred number of connections per connection identity that
should be maintained concurrently.</td>
<td NOSAVE>no preferred size</td>
</tr>

<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.protocol</tt></td>
<td NOSAVE>A list of space-separated protocol types of connections
that may be pooled. Valid types are "plain" and "ssl".
</td>
<td NOSAVE><tt>"plain"</tt></td>
</tr>


<tr NOSAVE>
<td NOSAVE><tt>com.sun.jndi.ldap.connect.pool.timeout</tt></td>
<td NOSAVE>The string representation of an integer that represents
the number of milliseconds that an idle connection may remain
in the pool without being closed and removed from the pool.
</td>
<td NOSAVE>no timeout</td>
</tr>

</table>
</center>


<h4>What Gets Pooled</h4>

When you request that a <tt>Context</tt> instance use connection
pooling by using the
<tt>"com.sun.jndi.ldap.connect.pool"</tt> environment property,
the connection that is used might or might not be pooled.
The default rule is that plain (non-SSL) connections that use
simple or no authentication are allowed to be pooled.  
You can change this default to include SSL connections and the DIGEST-MD5
authentication type by using system properties.  
To allow both plain and SSL connections to be pooled, set
the <tt>"com.sun.jndi.ldap.connect.pool.protocol"</tt> system property 
to the string <tt>"plain ssl"</tt>.
To allow connections of anonymous (none), simple and 
DIGEST-MD5 authentication types to be pooled, set
the <tt>com.sun.jndi.ldap.connect.pool.authentication</tt>
system property to the string <tt>"none simple DIGEST-MD5"</tt>.
<p>
There are a couple of environment properties that automatically
disqualify a <tt>Context</tt> instance from using
a pooled connection.
A <tt>Context</tt> instance cannot use a pooled connection if it has
its <tt>"java.naming.ldap.factory.socket"</tt> property set
to a custom socket factory class, 
or its <tt>"java.naming.security.sasl.callback"</tt> property set
to a custom callback handler class,
or its <tt>"com.sun.jndi.ldap.trace.ber"</tt> property set to enable protocol
tracing.


<h4>How Connections are Pooled</h4>

When a <tt>Context</tt> instance requests to use a pooled connection,
the LDAP provider needs to determine whether the request can be
satisfied by an existing pooled connection. It does this by
assigning a <em>connection identity</em> to each pooled connection 
and checking whether the incoming request has the same connection
identity as that of one of its pooled connections.
<p>
A connection identity is the set of the parameters required to create a
possibly authenticated LDAP connection. Its composition depends on the
authentication type of the request, as shown in the following table.
<p>
<center><table BORDER CELLPADDING=3 WIDTH="100%" NOSAVE >
<tr>
<th>
Authentication Type
</th>
<th>Connection Identity Contents</th>
</tr>

<tr>
<td>none</td>
<td>
<ul>
<li>connection controls
<li>host name, port number as specified in the <tt>"java.naming.provider.url"</tt>
property, referral, or URL supplied to the initial context
<li>
the contents of the following properties:
<blockquote><pre>
java.naming.security.protocol
java.naming.ldap.version
</pre></blockquote>
</ul>
</td>
</tr>

<tr>
<td>simple</td>
<td>
<ul>
<li>all of the information listed for none
<li>the contents of following properties:
<blockquote><pre>
java.naming.security.principal
java.naming.security.credentials
</pre></blockquote>
</ul>
</td>
</tr>

<tr>
<td>DIGEST-MD5</td>
<td>
<ul>
<li>all of the information listed for simple
<li>the contents of following properties:
<blockquote><pre>
java.naming.security.sasl.authorizationId
java.naming.security.sasl.realm
javax.security.sasl.qop
javax.security.sasl.strength
javax.security.sasl.server.authentication
javax.security.sasl.maxbuffer
javax.security.sasl.policy.noplaintext
javax.security.sasl.policy.noactive
javax.security.sasl.policy.nodictionary
javax.security.sasl.policy.noanonymous
javax.security.sasl.policy.forward
javax.security.sasl.policy.credentials
</pre></blockquote>
</ul>
</td>
</tr>
</table>
</center>
<p>


<h4>Pool Sizes</h4>

The LDAP provider maintains pools of connections; each pool
holds connections (either in-use or idle) 
that have the same connection identity.
There are three sizes that affect the management of each pool.
These sizes are global and affect all pools.
<p>

The <em>initial pool size</em> is the number of connections per
connection identity that the LDAP service provider creates when first
creating the pool (which corresponds to when the application first
requests a pooled connection for that connection identity).
Authentication of each connection in the pool is performed on
demand, as the connection gets used.  By default, the initial pool
size is 1 and can be changed by using the system property
<tt>"com.sun.jndi.ldap.connect.pool.initsize"</tt>.  It is typically used at
application start-up time to prime the pool with a certain number of
connections to a server.

<p>
The <em>maximum pool size</em> is the maximum number of connections
per connection identity that can be maintained concurrently by the
LDAP service provider.  Both in-use and idle connections contribute to
this number.  When the pool size reaches this number, no new
connection for the corresponding connection identity may be created
until a connection in the pool has been removed (i.e., the physical
connection is closed).  When the pool size reaches the maximum and all
of the connections in the pool are in use, the application's request
for a connection from that pool is blocked until a connection in the
pool either becomes idle or is removed.  A maximum pool size of 0
means that there is no maximum size: A request for a pooled connection
will use an existing pooled idle connection or a newly created pooled
connection.

<p>
The <em>preferred pool size</em> is the preferred number of
connections per connection identity that the LDAP service provider
should maintain. Both in-use and idle connections contribute to this
number. When an application requests the use of a pooled connection
and the pool size is less than the preferred size, the LDAP provider
will create and use a new pooled connection regardless of whether an
idle connection is available.  When an application is finished with a
pooled connection (by invoking <tt>Context.close()</tt> on all
contexts that share the connection) and the pool size is greater than
the preferred size, the LDAP provider will close and remove the pooled
connection from the pool.  A preferred pool size of 0 means that there
is no preferred size: A request for a pooled connection will result in
a newly created connection only if no idle ones are available.
<p>
Note that the maximum pool size overrides both the initial and
preferred pool sizes. For example, setting the preferred pool size
greater than the maximum pool size is effectively setting it to the
maximum pool size.


<h4>Idle Connections</h4>

When the application is finished with a pooled connection (by invoking
<tt>Context.close()</tt> on all contexts that share the connection),
the underlying pooled connection is marked as idle, waiting to be
reused.  By default, idle connections remain in the pool indefinitely
until they are garbage-collected.  If the
<tt>"com.sun.jndi.ldap.connect.pool.timeout"</tt> system property has
been set, the LDAP provider will automatically close and remove pooled
connections that have been idle for more than the specified period.
        </blockquote>
        <div class=NavBit>
            <a target=_top href=pool.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=faq.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer>
<div id=TagNotes>
    Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://developer.sun.com/contact/tutorial_feedback.jsp">Give
    us your feedback</a>.
<br><br>
    <a target="_blank" href="../../information/copyright.html">Copyright</a>
    1995-2007 Sun Microsystems, Inc.  All rights reserved.
    <span id=Download>
</span></div> 

    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Pooling
        <br><b>Next page:</b> Frequently Asked Questions
    </div>
    </body>
</html> 
