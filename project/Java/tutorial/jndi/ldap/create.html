



<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
    <head>
        <title>Creation (The Java&trade; Tutorials &gt; 
            Java Naming and Directory Interface(TM). &gt; Advanced Topics for LDAP Users)
</title>
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #E76F00;
        font-family: sans-serif; 
        font-weight: bold;
        font-size: 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;
        font-size: smaller;
        font-family: sans-serif; 
    }
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #E76F00;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h3, h4, h5 {
        color: #E76F00;
        font-family: sans-serif;
    }
    #ToggleLeft {
        display: none;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Java Naming and Directory Interface(TM).
        <br><b>Lesson:</b> Advanced Topics for LDAP Users
        <br><b>Section:</b> Connection Management
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Advanced Topics for LDAP Users</a></div>
<div class="linkAHEAD"><a href="ldap.html">LDAP v3</a></div>
<div class="linkAHEAD"><a href="jndi.html">JNDI as an LDAP API</a></div>
<div class="linkBHEAD"><a href="operations.html">How LDAP Operations Map to JNDI APIs</a></div>
<div class="linkBHEAD"><a href="exceptions.html">How LDAP Error Codes Map to JNDI Exceptions</a></div>
<div class="linkAHEAD"><a href="security.html">Security</a></div>
<div class="linkBHEAD"><a href="authentication.html">Modes of Authenticating to LDAP</a></div>
<div class="linkBHEAD"><a href="auth_mechs.html">Authentication Mechanisms</a></div>
<div class="linkBHEAD"><a href="anonymous.html">Anonymous</a></div>
<div class="linkBHEAD"><a href="simple.html">Simple</a></div>
<div class="linkBHEAD"><a href="sasl.html">SASL</a></div>
<div class="linkBHEAD"><a href="digest.html">Digest-MD5</a></div>
<div class="linkBHEAD"><a href="ssl.html">SSL and Custom Sockets</a></div>
<div class="linkAHEAD"><a href="rename.html">More LDAP Operations</a></div>
<div class="linkBHEAD"><a href="compare.html">LDAP Compare</a></div>
<div class="linkBHEAD"><a href="result.html">Search Results</a></div>
<div class="linkBHEAD"><a href="unsol.html"> LDAP Unsolicited Notifications</a></div>
<div class="linkAHEAD"><a href="connect.html">Connection Management</a></div>
<div class="nolinkBHEAD">Creation</div>
<div class="linkBHEAD"><a href="close.html"> Closing</a></div>
<div class="linkBHEAD"><a href="pool.html">Pooling</a></div>
<div class="linkBHEAD"><a href="config.html">Configuration</a></div>
<div class="linkAHEAD"><a href="faq.html">Frequently Asked Questions</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Java Naming and Directory Interface(TM).</a>
                &gt;
                <a href=index.html target=_top>Advanced Topics for LDAP Users</a>
            </span>
            <div class=NavBit>
                <a target=_top href=connect.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=close.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle>Creation</div>
            <blockquote>
There are several ways in which a connection is created. The most
common way is from the creation of an initial context.
When you create an 
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/InitialContext.html"><tt>InitialContext</tt></a>,
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/directory/InitialDirContext.html"><tt>InitialDirContext</tt></a>, or
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/ldap/InitialLdapContext.html"><tt>InitialLdapContext</tt></a>   by using the LDAP service provider, a connection is set up immediately with
the target LDAP server named in the 
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/Context.html#PROVIDER_URL"><tt>Context.PROVIDER_URL</tt></a>   property.
Each time an initial context is created, a new LDAP
connection is created.
See the <a href=pool.html>Connection Pooling</a> section for information on
how to change this behavior.
<p>
If the property value contains more than one URL, then each URL is tried
in turn until one is used to create a successful connection.
The property value is then updated to be the successful URL.
See the 
<a target="_top" href="http://java.sun.com/products/jndi/tutorial/ldap/misc/url.html#MULTI">JNDI Tutorial</a> <a target="_top" href="http://java.sun.com/products/jndi/tutorial/ldap/misc/url.html#MULTI"></a>for an example of how to create an initial context using a list of URLs.

<p>
There are three other direct ways in which a connection is
created.
<ol>
<li>
By passing a URL as the name argument to
the initial context.  When an LDAP or LDAPS URL is pass as a name
parameter to the initial context, the information in the URL is used
to create a new connection to the LDAP server, regardless of whether
the initial context instance itself has a connection to an LDAP
server. In fact, the initial context might not be connected to any
server. See the 

<a target="_top" href="http://java.sun.com/products/jndi/tutorial/beyond/url/initctx.html">JNDI Tutorial</a> <a target="_top" href="http://java.sun.com/products/jndi/tutorial/beyond/url/initctx.html"></a>    for more information on how URLs are used as names.
</li>
<li>
Another way that a connection is created is by use of a <tt>Reference</tt>.
When a 
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/Reference.html"><tt>Reference</tt> </a>  containing an LDAP or LDAPS URL is passed to
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/spi/NamingManager.html#getObjectInstance(java.lang.Object, javax.naming.Name, javax.naming.Context, java.util.Hashtable)"><tt>NamingManager.getObjectInstance()</tt></a>    or
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/spi/DirectoryManager.html#getObjectInstance(java.lang.Object, javax.naming.Name, javax.naming.Context, java.util.Hashtable, javax.naming.directory.Attributes)"><tt>DirectoryManager.getObjectInstance()</tt></a>, a new connection is created using information specified in the URL.
</li>
<li>
Finally, when a referral is followed manually or automatically, the information in
the referral is used to create a new connection.
See the 
<a target="_top" href="http://java.sun.com/products/jndi/tutorial/ldap/referral/index.html">JNDI Tutorial</a> <a target="_top" href="http://java.sun.com/products/jndi/tutorial/ldap/referral/index.html"></a>   for information on referrals.
</li>
</ul>

<a name=SHARE></a><h4>Shared Connections</h4>

<tt>Context</tt> instances and 
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/NamingEnumeration.html"><tt>NamingEnumeration</tt>s</a>     that are derived from one <tt>Context</tt> instance
share the same connection until changes to one of the
<tt>Context</tt> instances make sharing no longer possible.
For example, if you invoke
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/Context.html#lookup(javax.naming.Name)"><tt>Context.lookup()</tt></a>,
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/Context.html#listBindings(javax.naming.Name)"><tt>Context.listBindings()</tt></a>    or
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/directory/DirContext.html#search(javax.naming.Name, java.lang.String, javax.naming.directory.SearchControls)"><tt>DirContext.search()</tt></a>    from the initial context and get back other <tt>Context</tt> instances, 
then all of those <tt>Context</tt> instances will share the same connection.
<p>
Here is <a href=examples/Shared.java>an example</a>.
<blockquote><pre>
// Create initial context
DirContext ctx = new InitialDirContext(env);

// Get a copy of the same context
Context ctx2 = (Context)ctx.lookup("");

// Get a child context
Context ctx3 = (Context) ctx.lookup("ou=NewHires");
</pre></blockquote>
In this example, <tt>ctx</tt>, <tt>ctx2</tt>, and <tt>ctx3</tt>
will share the same connection.
<p>
Sharing is done regardless of how the <tt>Context</tt> instance came
into existence. For example, a <tt>Context</tt> instance obtained by following
a referral will share the same connection as the referral.

<p>
When you change a <tt>Context</tt> instance's environment properties 
that are related to 
a connection,
such as the principal name or credentials of the user, the <tt>Context</tt>
instance on which you make these changes will get its own connection
(if the connection is shared). <tt>Context</tt> instances that are derived
from this <tt>Context</tt> instance in the future will share this new connection.
<tt>Context</tt> instances that previously shared the old connection
are not affected (that is, they continue to use the old connection).
<p>
Here is <a href=examples/NewConn.java>an example</a> that uses two connections.
<blockquote><pre>
// Create initial context (first connection)
DirContext ctx = new InitialDirContext(env);

// Get a copy of the same context
DirContext ctx2 = (DirContext)ctx.lookup("");

// Change authentication properties in ctx2
ctx2.addToEnvironment(Context.SECURITY_PRINCIPAL, 
    "cn=C. User, ou=NewHires, o=JNDITutorial");
ctx2.addToEnvironment(Context.SECURITY_CREDENTIALS, "mysecret");

// Method on ctx2 will use new connection
System.out.println(ctx2.getAttributes("ou=NewHires"));
</pre></blockquote>
<tt>ctx2</tt> initially shares the same connection with <tt>ctx</tt>.
But when its principal and password properties are changed,
it can no longer use <tt>ctx</tt>'s connection.
The LDAP provider will automatically create a new connection for
<tt>ctx2</tt>.
<p>
Similarly, if you use
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/javax/naming/ldap/LdapContext.html#reconnect(javax.naming.ldap.Control[])"><tt>LdapContext.reconnect()</tt></a>  to change the <tt>Context</tt> instance's connection controls,
the <tt>Context</tt> instance will get its own connection 
if the connection was being shared.

<p>

If the <tt>Context</tt> instance's connection was not being shared
(i.e., no <tt>Context</tt>s have been derived from it),
then changes to its environment or connection controls will not cause
a new connection to be created.  Instead, any changes relevant to the
connection will be applied to the existing connection.

<a name=TIMEOUT><h4>Creation Timeouts</h4></a>

Not all connection creations are successful.  If the LDAP provider
cannot establish a connection within a certain timeout period, it
aborts the connection attempt. By default, this timeout period is the
network (TCP) timeout value, which is in the order of a few minutes.
To change the timeout period, you use the
<tt>"com.sun.jndi.ldap.connect.timeout"</tt> environment property.
The value of this property is  the string representation of an integer
representing the connection timeout in milliseconds.
<p>
Here is <a href=examples/Timeout.java>an example</a>.

<blockquote><pre>
// Set up environment for creating initial context
Hashtable env = new Hashtable(11);
env.put(Context.INITIAL_CONTEXT_FACTORY, 
    "com.sun.jndi.ldap.LdapCtxFactory");
env.put(Context.PROVIDER_URL, "ldap://localhost:389/o=JNDITutorial");

// Specify timeout to be 5 seconds
env.put("com.sun.jndi.ldap.connect.timeout", "5000");

// Create initial context
DirContext ctx = new InitialDirContext(env);

// do something useful with ctx
</pre></blockquote>

In this example, if a connection cannot be created within 5 seconds,
an exception will be thrown.
<p>
If the <tt>Context.PROVIDER_URL</tt> property contains more than one
URL, the provider will use the timeout for each URL.  For
example, if there are 3 URLs and the timeout has been specified to be
5 seconds, then the provider will wait for a maximum of 15 seconds in
total.
<p>
See the <a href=pool.html#TIMEOUT>Connection Pooling</a> section
for information on how this property affects connection pooling.
        </blockquote>
        <div class=NavBit>
            <a target=_top href=connect.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=close.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer>
<div id=TagNotes>
    Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://developer.sun.com/contact/tutorial_feedback.jsp">Give
    us your feedback</a>.
<br><br>
    <a target="_blank" href="../../information/copyright.html">Copyright</a>
    1995-2007 Sun Microsystems, Inc.  All rights reserved.
    <span id=Download>
</span></div> 

    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Connection Management
        <br><b>Next page:</b>  Closing
    </div>
    </body>
</html> 
