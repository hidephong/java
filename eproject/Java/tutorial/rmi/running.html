<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
    <head>
        <title>Running the Example Programs (The Java&trade; Tutorials &gt; 
            RMI)
</title>
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #E76F00;
        font-family: sans-serif; 
        font-weight: bold;
        font-size: 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;
        font-size: smaller;
        font-family: sans-serif; 
    }
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #E76F00;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h3, h4, h5 {
        color: #E76F00;
        font-family: sans-serif;
    }
    #ToggleLeft {
        display: none;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> RMI
        <br><b>Section:</b> Compiling and Running the Example
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkAHEAD"><a href="overview.html">An Overview of RMI Applications</a></div>
<div class="linkAHEAD"><a href="server.html">Writing an RMI Server</a></div>
<div class="linkBHEAD"><a href="designing.html">Designing a Remote Interface</a></div>
<div class="linkBHEAD"><a href="implementing.html">Implementing a Remote Interface</a></div>
<div class="linkAHEAD"><a href="client.html">Creating a Client Program</a></div>
<div class="linkAHEAD"><a href="example.html">Compiling and Running the Example</a></div>
<div class="linkBHEAD"><a href="compiling.html">Compiling the Example Programs</a></div>
<div class="nolinkBHEAD">Running the Example Programs</div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../index.html target=_top>Home Page</a>
                &gt;
                <a href=./index.html target=_top>RMI</a>
            </span>
            <div class=NavBit>
                <a target=_top href=compiling.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=./TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=./end.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle>Running the Example Programs</div>
            <blockquote>
</blockquote>
<h3>A Note About Security</h3>
<blockquote>
The server and client programs run with a security manager
installed. When you run either program, you need to specify a security
policy file so that the code is granted the security permissions it
needs to run.
Here is an example <a href="examples/server.policy">policy file to use
with the server program</a>:
<blockquote><pre>
grant codeBase "file:/home/ann/src/" {
    permission java.security.AllPermission;
};
</pre></blockquote>
<P>
Here is an example <a href="examples/client.policy">policy file to
use with the client program</a>:
<blockquote><pre>
grant codeBase "file:/home/jones/src/" {
    permission java.security.AllPermission;
};
</pre></blockquote>
<P>
For both example policy files, all permissions are granted to
the classes in the program's local class path, because the
local application code is trusted, but no permissions are granted to code
downloaded from other locations.  Therefore, the compute engine server
restricts the tasks that it executes (whose code is not known to
be trusted and might be hostile) from performing any operations
that require security permissions.  The example client's
<CODE>Pi</CODE> task does not require any permissions to execute.
<P>
In this example, the policy file for the server program is
named <CODE>server.policy</CODE>, and the policy file for the client
program is named <CODE>client.policy</CODE>.
</blockquote>

<h3>Starting the Server</h3>
<blockquote>
Before starting the compute engine, you need to start the RMI registry. The
RMI registry is a simple server-side bootstrap naming facility that
enables remote clients to obtain a reference to an initial remote object.
It can be started with the <CODE>rmiregistry</CODE> command.
Before you execute <CODE>rmiregistry</CODE>, you must make sure that
the shell or window in which you will run <CODE>rmiregistry</CODE>
either has no <CODE>CLASSPATH</CODE> environment variable set or has a
<CODE>CLASSPATH</CODE> environment variable that does not include the
path to any classes that you want downloaded to clients of your
remote objects.
<P>
To start the registry on the server, execute the
<CODE>rmiregistry</CODE> command. This command produces no output and
is typically run in the background. For this example, the
registry is started on the host <CODE>zaphod</CODE>.
<p>
<blockquote>
<hr>
<DT>
<strong>Microsoft Windows</strong> (use <CODE>javaw</CODE> if <CODE>start</CODE> is not available):
</DT>
<pre>
start rmiregistry
</pre>
<P>
<DT>
<strong>Solaris OS or Linux</strong>:
</DT>
<pre>
rmiregistry &amp;
</pre>
<hr></blockquote>
<P>
By default, the registry runs on port 1099. To start the registry on a
different port, specify the port number on the command line. Do not
forget to unset your <CODE>CLASSPATH</CODE> environment variable.
<p>
<blockquote>
<hr>
<DT>
<strong>Microsoft Windows</strong>:
</DT>
<pre>
start rmiregistry 2001
</pre>
<P>
<DT>
<strong>Solaris OS or Linux</strong>:
</DT>
<pre>
rmiregistry 2001 &amp;
</pre>
<hr></blockquote>
<P>
Once the registry is started, you can start the server. You need
to make sure that both the <CODE>compute.jar</CODE> file and the remote
object implementation class are
in your class path.
When you start the compute engine, you need to specify, using the
<CODE>java.rmi.server.codebase</CODE> property, where the server's
classes are network accessible. In this example, the server-side
classes to be made available for downloading are the
<CODE>Compute</CODE> and <CODE>Task</CODE> interfaces, which are
available in the <CODE>compute.jar</CODE> file in the
<CODE>public_html\classes</CODE> directory of user
<CODE>ann</CODE>. The compute engine server is started on the host
<CODE>zaphod</CODE>, the same host on which the registry was started.
<p>
<blockquote>
<hr>
<DT>
<strong>Microsoft Windows</strong>:
</DT>
<pre>
java -cp c:\home\ann\src;c:\home\ann\public_html\classes\compute.jar
     -Djava.rmi.server.codebase=file:/c:/home/ann/public_html/classes/compute.jar
     -Djava.rmi.server.hostname=zaphod.east.sun.com
     -Djava.security.policy=server.policy
        engine.ComputeEngine
</PRE>
<P>
<DT>
<strong>Solaris OS or Linux</strong>:
</DT>
<pre>
java -cp /home/ann/src:/home/ann/public_html/classes/compute.jar
     -Djava.rmi.server.codebase=http://zaphod/~ann/classes/compute.jar
     -Djava.rmi.server.hostname=zaphod.east.sun.com
     -Djava.security.policy=server.policy
        engine.ComputeEngine
</PRE>
<hr></blockquote>
<P>
The above <CODE>java</CODE> command defines the following system properties:
<UL>
<LI> The <CODE>java.rmi.server.codebase</CODE> property specifies the
     location, a codebase URL, from which the definitions for classes
     originating <I>from</I> this server can be
     downloaded. If the codebase specifies a directory hierarchy
     (as opposed to a JAR file), you must include a trailing
     slash at the end of the codebase URL.
<LI> The <CODE>java.rmi.server.hostname</CODE> property specifies the
     host name or address to put in the stubs for remote objects exported
     in this Java virtual machine. This value is the host name or address used by
     clients when they attempt to communicate remote method invocations.
     By default, the RMI implementation uses the server's IP address as
     indicated by the <CODE>java.net.InetAddress.getLocalHost</CODE> API.
     However, sometimes, this address is not appropriate for all clients and
     a fully qualified host name would be more effective.
     To ensure that RMI uses a host name (or IP address) for the
     server that is routable from all potential clients,
     set the <CODE>java.rmi.server.hostname</CODE> property.
<LI> The <CODE>java.security.policy</CODE> property is used to specify
     the policy file that contains the permissions you intend to grant.
</UL>
</blockquote>

<h3>Starting the Client</h3>
<blockquote>
Once the registry and the compute engine are running, you can start the client, specifying the following:
<UL>
<LI> The location where the client serves its classes (the
     <CODE>Pi</CODE> class) by using the <CODE>java.rmi.server.codebase</CODE>
     property
<LI> The <CODE>java.security.policy</CODE> property, which is used to specify
     the security policy file that contains the permissions you intend
     to grant to various pieces of code
<LI> As command-line arguments, the host name of the server (so that the
     client knows where to locate the <CODE>Compute</CODE> remote
     object) and the number of decimal places to use in the 
<IMG SRC="../figures/rmi/pi.gif " WIDTH="9 " HEIGHT="9  " ALT="">     calculation
</UL>
<P>
Start the
client on another host (a host named <CODE>ford</CODE>, for example) as
follows:
<p>
<blockquote>
<hr>
<DT>
<strong>Microsoft Windows</strong>:
</DT>
<pre>
java -cp c:\home\jones\src;c:\home\jones\public_html\classes\compute.jar
     -Djava.rmi.server.codebase=file:/c:/home/jones/public_html/classes/
     -Djava.security.policy=client.policy
	client.ComputePi zaphod.east.sun.com 45
</pre>

<P>
<DT>
<strong>Solaris OS or Linux</strong>:
</DT>
<pre>
java -cp /home/jones/src:/home/jones/public_html/classes/compute.jar
     -Djava.rmi.server.codebase=http://ford/~jones/classes/
     -Djava.security.policy=client.policy 
        client.ComputePi zaphod.east.sun.com 45
</PRE>
<hr></blockquote>
<P>
Note that the class path is set on the command line so that the
interpreter can find the client classes and the JAR file
containing the interfaces.  Also note that the value of the
<CODE>java.rmi.server.codebase</CODE> property, which specifies a
directory hierarchy, ends with a trailing slash.
<P>
After you start the client, the following output is displayed:
<blockquote><pre>
3.141592653589793238462643383279502884197169399
</pre></blockquote>
<P>
The following figure illustrates where the <CODE>rmiregistry</CODE>,
the <CODE>ComputeEngine</CODE> server, and the <CODE>ComputePi</CODE>
client obtain classes during program execution.

<p><center><IMG SRC="../figures/rmi/rmi-5.gif" WIDTH="400" HEIGHT="182" ALIGN="BOTTOM" ALT=""></center></p>
<P>
When the <CODE>ComputeEngine</CODE> server binds its remote object
reference in the registry, the registry downloads the <CODE>Compute</CODE>
and <CODE>Task</CODE> interfaces on which the stub class depends.
These classes are downloaded from either the
<CODE>ComputeEngine</CODE> server's web server or file system,
depending on the type of codebase URL used when starting the server.
<P>
Because the <CODE>ComputePi</CODE> client has both the
<CODE>Compute</CODE> and the <CODE>Task</CODE> interfaces available in
its class path, it loads their definitions from its class path, not from the
server's codebase.
<P>
Finally, the <CODE>Pi</CODE> class is loaded into the
<CODE>ComputeEngine</CODE> server's Java virtual machine when the <CODE>Pi</CODE>
object is passed in the <CODE>executeTask</CODE> remote call to the
<CODE>ComputeEngine</CODE> object. The <CODE>Pi</CODE> class is loaded
by the server from either the client's web server or file system,
depending on the type of codebase URL used when starting the client.
        </blockquote>
        <div class=NavBit>
            <a target=_top href=compiling.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=./TOC.html>Trail</a>
            &bull;
            <a target=_top href=./end.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer>
<div id=TagNotes>
    Problems with the examples? Try <a target="_blank"
        href=../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://developer.sun.com/contact/tutorial_feedback.jsp">Give
    us your feedback</a>.
<br><br>
    <a target="_blank" href="../information/copyright.html">Copyright</a>
    1995-2007 Sun Microsystems, Inc.  All rights reserved.
    <span id=Download>
</span></div> 

    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Compiling the Example Programs
        <br><b>Next page:</b> End of Trail
    </div>
    </body>
</html> 
