
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
    <head>
        <title>Wrapper Implementations (The Java&trade; Tutorials &gt; 
            Collections &gt; Implementations)
</title>
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: center;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #E76F00;
        font-family: sans-serif; 
        font-weight: bold;
        font-size: 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;
        font-size: smaller;
        font-family: sans-serif; 
    }
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #E76F00;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h3, h4, h5 {
        color: #E76F00;
        font-family: sans-serif;
    }
    #ToggleLeft {
        display: none;
    }

    /t

</style>
<script type="text/javascript">
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide the TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }
    
</script>

    </head>
<body onload="load()">
    <div id=TopBar> <div id=TopBar_tr> <div id=TopBar_tl> <div id=TopBar_br> <div id=TopBar_bl> 
                        <div id=TopBar_right> 
                            <a target="_blank"
                                href="http://java.sun.com/javase/6/download.jsp">Download
                                the JDK</a>
                            <br>
                            <a href="../../search.html" target="_blank">Search the
                                Tutorials</a>
                            <br>
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide the TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class=PrintHeaders>
        <b>Trail:</b> Collections
        <br><b>Lesson:</b> Implementations
    </div>

    <div id=LeftBar class=LeftBar_shown>
        <div id=Contents>
            <div class="linkLESSON"><a href="index.html">Implementations</a></div>
<div class="linkAHEAD"><a href="set.html">Set Implementations</a></div>
<div class="linkAHEAD"><a href="list.html">List Implementations</a></div>
<div class="linkAHEAD"><a href="map.html">Map Implementations</a></div>
<div class="linkAHEAD"><a href="queue.html">Queue Implementations</a></div>
<div class="nolinkAHEAD">Wrapper Implementations</div>
<div class="linkAHEAD"><a href="convenience.html">Convenience Implementations</a></div>
<div class="linkAHEAD"><a href="summary.html">Summary of Implementations</a></div>
<div class="linkQUESTIONS"><a href="QandE/questions.html">Questions and Exercises</a></div>
</div>
    </div>
    <div id=MainFlow class=MainFlow_indented>
            <span id=BreadCrumbs>
                <a href=../../index.html target=_top>Home Page</a>
                &gt;
                <a href=../index.html target=_top>Collections</a>
                &gt;
                <a href=index.html target=_top>Implementations</a>
            </span>
            <div class=NavBit>
                <a target=_top href=queue.html>&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target=_top href=../TOC.html>Trail</a>&nbsp;&bull;&nbsp;<a target=_top href=convenience.html>Next&nbsp;&raquo;</a>
            </div>
            <div id=PageTitle>Wrapper Implementations</div>
            <blockquote>
Wrapper implementations delegate all their real work to a specified
collection but add extra functionality on top of what this collection
offers. For design pattern fans, this is an example of the
<em>decorator</em> pattern. Although it may seem a bit exotic,
it's really pretty straightforward.

<p>

These implementations are anonymous; rather than providing a public class,
the library provides a static factory method. All these implementations
are found in the

<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/Collections.html"><code>Collections</code></a> class, which consists solely of static methods.

</blockquote>


<h3 fmstyle=C-Head>Synchronization Wrappers</h3>

<blockquote>


The synchronization wrappers add automatic synchronization (thread-safety)
to an arbitrary collection. Each of the six core collection interfaces &mdash;

<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/Collection.html"><code>Collection</code></a>,
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/Set.html"><code>Set</code></a>,
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/List.html"><code>List</code></a>,

<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/Map.html"><code>Map</code></a>,

<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/SortedSet.html"><code>SortedSet</code></a>, and

<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/SortedMap.html"><code>SortedMap</code></a> &mdash; has one static factory method.

<blockquote><pre>
public static &lt;T&gt; Collection&lt;T&gt;
    synchronizedCollection(Collection&lt;T&gt; c);
public static &lt;T&gt; Set&lt;T&gt;
    synchronizedSet(Set&lt;T&gt; s);
public static &lt;T&gt; List&lt;T&gt;
    synchronizedList(List&lt;T&gt; list);
public static &lt;K,V&gt; Map&lt;K,V&gt;
    synchronizedMap(Map&lt;K,V&gt; m);
public static &lt;T&gt; SortedSet&lt;T&gt;
    synchronizedSortedSet(SortedSet&lt;T&gt; s);
public static &lt;K,V&gt; SortedMap&lt;K,V&gt;
    synchronizedSortedMap(SortedMap&lt;K,V&gt; m);
</pre></blockquote>


Each of these methods returns a synchronized (thread-safe)
<code>Collection</code> backed up by the specified collection.
To guarantee serial access, <em>all</em> access to
the backing collection must be accomplished through the returned
collection. The easy way to guarantee this is not to keep a reference
to the backing collection. Create the synchronized collection with the following trick.

<blockquote><pre>
List&lt;Type&gt; list =
    Collections.synchronizedList(new ArrayList&lt;Type&gt;());
</pre></blockquote>

A collection created in this fashion is every bit as thread-safe
as a normally synchronized collection, such as a
<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/Vector.html"><code>Vector</code></a>.
<p>
In the face of concurrent access, it is imperative that the user
manually synchronize on the returned collection when iterating over it.
The reason is that iteration is accomplished via multiple calls into the
collection, which must be composed into a single atomic operation.
The following is the idiom to iterate over a wrapper-synchronized collection.

<blockquote><pre>
Collection&lt;Type&gt; c =
    Collections.synchronizedCollection(myCollection);
synchronized(c) {
    for (Type e : c)
        foo(e);
}
</pre></blockquote>

If an explicit iterator is used, the <code>iterator</code> method must be called
from within the <code>synchronized</code> block. Failure to follow
this advice may result in nondeterministic behavior.
The idiom for iterating over a <code>Collection</code> view of a synchronized
<code>Map</code> is similar. It is imperative that the user synchronize
on the synchronized <code>Map</code> when iterating over any of its
<code>Collection</code> views rather than synchronizing on the
<code>Collection</code> view itself, as shown in the following example.

<blockquote><pre>
Map&lt;KeyType, ValType&gt; m =
    Collections.synchronizedMap(new HashMap&lt;KeyType, ValType&gt;());
    ...
Set&lt;KeyType&gt; s = m.keySet();
    ...
synchronized(m) {  // Synchronizing on m, not s!
    while (KeyType k : s)
        foo(k);
}
</pre></blockquote>

One minor downside of using wrapper implementations is that you
do not have the ability to execute any <em>noninterface</em>
operations of a wrapped implementation. So, for instance,
in the preceding <code>List</code> example, you cannot call
<code>ArrayList</code>'s

<a class="APILink" target="_blank" href="http://java.sun.com/javase/6/docs/api/java/util/ArrayList.html#ensureCapacity(int)"><code>ensureCapacity</code></a> operation on the wrapped <code>ArrayList</code>.

</blockquote>

<h3 fmstyle=C-Head>Unmodifiable Wrappers</h3>

<blockquote>

Unlike synchronization wrappers, which add functionality to the wrapped
collection, the unmodifiable wrappers take functionality away.
In particular, they take away the ability to modify the collection
by intercepting all the operations that would modify the collection
and throwing an <code>UnsupportedOperationException</code>.
Unmodifiable wrappers have two main uses, as follows:
<ul>
<li>
To make a collection immutable once it has been built. In this case,
it's good practice not to maintain a reference to the backing collection.
This absolutely guarantees immutability.

<li>
To allow certain clients read-only access to your data structures.
You keep a reference to the backing collection but hand out a reference
to the wrapper. In this way, clients can look but not modify,
while you maintain full access.

</ul>

Like synchronization wrappers, each of the six core <code>Collection</code>
interfaces has one static factory method.

<blockquote><pre>
public static &lt;T&gt; Collection&lt;T&gt;
    unmodifiableCollection(Collection&lt;? extends T&gt; c);
public static &lt;T&gt; Set&lt;T&gt;
    unmodifiableSet(Set&lt;? extends T&gt; s);
public static &lt;T&gt; List&lt;T&gt;
    unmodifiableList(List&lt;? extends T&gt; list);
public static &lt;K,V&gt; Map&lt;K, V&gt;
    unmodifiableMap(Map&lt;? extends K, ? extends V&gt; m);
public static &lt;T&gt; SortedSet&lt;T&gt;
    unmodifiableSortedSet(SortedSet&lt;? extends T&gt; s);
public static &lt;K,V&gt; SortedMap&lt;K, V&gt;
    unmodifiableSortedMap(SortedMap&lt;K, ? extends V&gt; m);
</pre></blockquote>

</blockquote>

<h3 fmstyle=C-Head>Checked Interface Wrappers</h3>

<blockquote>

The <code>Collections.checked</code> <em>interface</em> wrappers
are provided for use with generic collections. These implementations
return a <em>dynamically</em> type-safe view of the specified collection,
which throws a <code>ClassCastException</code> if a client attempts to
add an element of the wrong type. The generics mechanism in the
language provides compile-time (static) type-checking, but it is
possible to defeat this mechanism. Dynamically type-safe views
eliminate this possibility entirely.
        </blockquote>
        <div class=NavBit>
            <a target=_top href=queue.html>&laquo; Previous</a>
            &bull;
            <a target=_top href=../TOC.html>Trail</a>
            &bull;
            <a target=_top href=convenience.html>Next &raquo;</a>
        </div>
    </div>
    <div id=Footer>
<div id=TagNotes>
    Problems with the examples? Try <a target="_blank"
        href=../../information/run-examples.html>Compiling and Running
        the Examples: FAQs</a>.
    <br>
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://developer.sun.com/contact/tutorial_feedback.jsp">Give
    us your feedback</a>.
<br><br>
    <a target="_blank" href="../../information/copyright.html">Copyright</a>
    1995-2007 Sun Microsystems, Inc.  All rights reserved.
    <span id=Download>
</span></div> 

    </div>
    <div class=PrintHeaders>
        <b>Previous page:</b> Queue Implementations
        <br><b>Next page:</b> Convenience Implementations
    </div>
    </body>
</html> 
